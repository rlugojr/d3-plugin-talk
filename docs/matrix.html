<!DOCTYPE html>  <html> <head>   <title>matrix.js</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               matrix.js             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>               <p>author : Erik Solen
license : MIT</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">define</span><span class="p">([</span><span class="s1">&#39;jquery&#39;</span><span class="p">,</span> <span class="s1">&#39;lodash&#39;</span><span class="p">,</span> <span class="s1">&#39;d3&#39;</span><span class="p">,</span> <span class="s1">&#39;jquery-ui&#39;</span><span class="p">],</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$</span><span class="p">,</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">d3</span><span class="p">)</span> <span class="p">{</span>

    <span class="nx">$</span><span class="p">.</span><span class="nx">widget</span><span class="p">(</span><span class="s1">&#39;ui.matrix&#39;</span><span class="p">,</span> <span class="p">{</span>

        <span class="nx">options</span><span class="o">:</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <p>default min-width applied to data cells</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="nx">cellWidth</span><span class="o">:</span> <span class="s1">&#39;32px&#39;</span><span class="p">,</span></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p>explicity state if the overall column and row is aggregated</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="nx">aggregated</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
            <span class="nx">color</span><span class="o">:</span> <span class="nx">d3</span><span class="p">.</span><span class="nx">interpolateHsl</span><span class="p">(</span><span class="s2">&quot;hsl(273, 38%, 100%)&quot;</span><span class="p">,</span> <span class="s2">&quot;hsl(273, 38%, 55%)&quot;</span><span class="p">)</span>
        <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>common formats</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">_noDecimal</span><span class="o">:</span> <span class="nx">d3</span><span class="p">.</span><span class="nx">format</span><span class="p">(</span><span class="s1">&#39;,f&#39;</span><span class="p">),</span>
        <span class="nx">_onePlace</span><span class="o">:</span> <span class="nx">d3</span><span class="p">.</span><span class="nx">format</span><span class="p">(</span><span class="s1">&#39;,.1f&#39;</span><span class="p">),</span></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>returns a formatted number with a k, m or b suffix as needed</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <pre><code>1.234         -&gt;      '1'
123           -&gt;    '123'
1234          -&gt;   '1.2k'
12345         -&gt;    '12k'
4512312       -&gt;   '4.5m'
67123123      -&gt;  '67.1m'
7812312312    -&gt;   '7.8b'
189123123123  -&gt;   '189b'
2189123123123 -&gt; '2,189b'
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">kFormat</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">n</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">n</span> <span class="o">&lt;</span> <span class="mi">1000</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">_</span><span class="p">.</span><span class="nx">escape</span><span class="p">(</span><span class="nx">n</span><span class="p">);</span> <span class="p">}</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">n</span> <span class="o">&lt;</span> <span class="mi">10000</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_onePlace</span><span class="p">(</span><span class="nx">n</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;k&#39;</span><span class="p">;</span> <span class="p">}</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">n</span> <span class="o">&lt;</span> <span class="mi">1000000</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_noDecimal</span><span class="p">(</span><span class="nx">n</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;k&#39;</span><span class="p">;</span> <span class="p">}</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">n</span> <span class="o">&lt;</span> <span class="mi">100000000</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_onePlace</span><span class="p">(</span><span class="nx">n</span> <span class="o">/</span> <span class="mi">1000000</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;m&#39;</span><span class="p">;</span> <span class="p">}</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">n</span> <span class="o">&lt;</span> <span class="mi">1000000000</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_noDecimal</span><span class="p">(</span><span class="nx">n</span> <span class="o">/</span> <span class="mi">1000000</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;m&#39;</span><span class="p">;</span> <span class="p">}</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">n</span> <span class="o">&lt;</span> <span class="mi">100000000000</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_onePlace</span><span class="p">(</span><span class="nx">n</span> <span class="o">/</span> <span class="mi">1000000000</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;b&#39;</span><span class="p">;</span> <span class="p">}</span>
            <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_noDecimal</span><span class="p">(</span><span class="nx">n</span> <span class="o">/</span> <span class="mi">1000000000</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;b&#39;</span><span class="p">;</span>
        <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>Data is assumed to be a 2 dimensional array with all inner arrays the same length.
An appropriate data max is assumed to be passed in too.
Labels for the top headers are the first row.
Labels for individual rows are the first element in the inner arrays.
All labels and values will be html escaped.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">_init</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">,</span>
                <span class="nx">tableHeaderRow</span><span class="p">,</span>
                <span class="nx">tableRows</span><span class="p">,</span></pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p>first row has header labels html escaped</p>             </td>             <td class="code">               <div class="highlight"><pre>                <span class="nx">escapedTopHeaderData</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">first</span><span class="p">(</span><span class="nx">self</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">data</span><span class="p">),</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">label</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">_</span><span class="p">.</span><span class="nx">escape</span><span class="p">(</span><span class="nx">label</span><span class="p">);</span> <span class="p">}),</span></pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <p>the rest has data starting with row labels</p>             </td>             <td class="code">               <div class="highlight"><pre>                <span class="nx">data</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">rest</span><span class="p">(</span><span class="nx">self</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">data</span><span class="p">),</span>
                <span class="nx">dataWidth</span> <span class="o">=</span> <span class="nx">escapedTopHeaderData</span><span class="p">.</span><span class="nx">length</span><span class="p">,</span>
                <span class="nx">dataHeight</span> <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">length</span><span class="p">,</span>
                <span class="nx">colorScale</span> <span class="o">=</span> <span class="nx">d3</span><span class="p">.</span><span class="nx">scale</span><span class="p">.</span><span class="nx">linear</span><span class="p">()</span>
                    <span class="p">.</span><span class="nx">domain</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="nx">self</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">max</span><span class="p">])</span>
                    <span class="p">.</span><span class="nx">range</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]),</span>
                <span class="nx">table</span> <span class="o">=</span> <span class="nx">self</span><span class="p">.</span><span class="nx">element</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s1">&#39;&lt;table&gt;&lt;/table&#39;</span><span class="p">).</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;table:last&#39;</span><span class="p">);</span>
            <span class="nx">self</span><span class="p">.</span><span class="nx">formatter</span> <span class="o">=</span> <span class="nx">self</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">format</span> <span class="o">||</span> <span class="nx">self</span><span class="p">.</span><span class="nx">kFormat</span><span class="p">;</span>
            <span class="nx">tableHeaderRow</span> <span class="o">=</span> <span class="s1">&#39;&lt;tr class=&quot;labels&quot;&gt;&lt;th&gt;&#39;</span> <span class="o">+</span>
                <span class="nx">escapedTopHeaderData</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;&lt;/th&gt;&lt;th&gt;&#39;</span><span class="p">)</span> <span class="o">+</span>
                <span class="s1">&#39;&lt;/th&gt;&lt;/tr&gt;&#39;</span><span class="p">;</span>
            <span class="nx">tableRows</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">row</span><span class="p">,</span> <span class="nx">height_index</span><span class="p">)</span> <span class="p">{</span>
                <span class="kd">var</span> <span class="nx">cells</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">row</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">val</span><span class="p">,</span> <span class="nx">width_index</span><span class="p">)</span> <span class="p">{</span>
                    <span class="kd">var</span> <span class="nx">scaledColor</span><span class="p">,</span>
                        <span class="nx">colorVal</span> <span class="o">=</span> <span class="nx">val</span><span class="p">,</span>
                        <span class="nx">firstCell</span> <span class="o">=</span> <span class="p">(</span><span class="nx">width_index</span> <span class="o">===</span> <span class="mi">0</span><span class="p">),</span>
                        <span class="nx">lastCell</span> <span class="o">=</span> <span class="p">(</span><span class="nx">width_index</span> <span class="o">===</span> <span class="p">(</span><span class="nx">dataWidth</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)),</span>
                        <span class="nx">lastRow</span> <span class="o">=</span> <span class="p">(</span><span class="nx">height_index</span> <span class="o">===</span> <span class="p">(</span><span class="nx">dataHeight</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)),</span>
                        <span class="nx">cellWidthStyle</span> <span class="o">=</span> <span class="s1">&#39;min-width:&#39;</span> <span class="o">+</span> <span class="nx">self</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">cellWidth</span> <span class="o">+</span> <span class="s1">&#39;;&#39;</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p>treat the first element in the array as a label</p>             </td>             <td class="code">               <div class="highlight"><pre>                    <span class="k">if</span> <span class="p">(</span><span class="nx">firstCell</span><span class="p">)</span> <span class="p">{</span>
                        <span class="k">return</span> <span class="s1">&#39;&lt;th&gt;&#39;</span> <span class="o">+</span> <span class="nx">_</span><span class="p">.</span><span class="nx">escape</span><span class="p">(</span><span class="nx">val</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;&lt;/th&gt;&#39;</span><span class="p">;</span>
                    <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <p>don't show null or undefined values</p>             </td>             <td class="code">               <div class="highlight"><pre>                    <span class="k">if</span> <span class="p">(</span><span class="nx">val</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <p>scale color value down when it is an aggregated overall</p>             </td>             <td class="code">               <div class="highlight"><pre>                        <span class="k">if</span> <span class="p">(</span><span class="nx">lastCell</span> <span class="o">&amp;&amp;</span> <span class="nx">self</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">aggregated</span><span class="p">)</span> <span class="p">{</span>
                            <span class="nx">colorVal</span> <span class="o">=</span> <span class="nx">colorVal</span> <span class="o">/</span> <span class="nx">dataWidth</span><span class="p">;</span>
                        <span class="p">}</span>
                        <span class="k">if</span> <span class="p">(</span><span class="nx">lastRow</span> <span class="o">&amp;&amp;</span> <span class="nx">self</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">aggregated</span><span class="p">)</span> <span class="p">{</span>
                            <span class="nx">colorVal</span> <span class="o">=</span> <span class="nx">colorVal</span> <span class="o">/</span> <span class="nx">dataHeight</span><span class="p">;</span>
                        <span class="p">}</span>
                        <span class="nx">scaledColor</span> <span class="o">=</span> <span class="nx">self</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">color</span><span class="p">(</span><span class="nx">colorScale</span><span class="p">(</span><span class="nx">colorVal</span><span class="p">));</span>
                        <span class="k">return</span> <span class="s1">&#39;&lt;td style=&quot;&#39;</span> <span class="o">+</span> <span class="nx">cellWidthStyle</span> <span class="o">+</span> <span class="s1">&#39;background:&#39;</span> <span class="o">+</span> <span class="nx">scaledColor</span> <span class="o">+</span> <span class="s1">&#39;;&quot;&gt;&#39;</span> <span class="o">+</span>
                            <span class="nx">self</span><span class="p">.</span><span class="nx">formatter</span><span class="p">(</span><span class="nx">val</span><span class="p">)</span> <span class="o">+</span>
                            <span class="s1">&#39;&lt;/td&gt;&#39;</span><span class="p">;</span>
                    <span class="p">}</span>
                    <span class="k">return</span> <span class="p">(</span><span class="s1">&#39;&lt;td style=&quot;&#39;</span> <span class="o">+</span> <span class="nx">cellWidthStyle</span> <span class="o">+</span> <span class="s1">&#39;background:#fff;&quot;&gt;&amp;mdash;&lt;/td&gt;&#39;</span><span class="p">);</span>
                <span class="p">}).</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;\n&#39;</span><span class="p">);</span>
                <span class="k">return</span> <span class="s1">&#39;&lt;tr class=&quot;labels&quot;&gt;&#39;</span> <span class="o">+</span> <span class="nx">cells</span> <span class="o">+</span> <span class="s1">&#39;&lt;/tr&gt;&#39;</span><span class="p">;</span>
            <span class="p">}).</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;\n&#39;</span><span class="p">);</span>
            <span class="nx">table</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="nx">tableHeaderRow</span> <span class="o">+</span> <span class="nx">tableRows</span><span class="p">);</span>
        <span class="p">}</span>

    <span class="p">});</span>

<span class="p">});</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 